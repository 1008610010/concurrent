# **线程组和线程的优先级**

## 1.线程组(ThreadGroup)的定义
1.1  java中用ThreadGroup来表示线程组，我们可以使用程序直接对线程组进行控制。
默认的情况下，所有的线程都是属于主线程。<br>
1.2  ThreadGroup和Thread的关系就如同他们的字面意思一样简单粗暴，每个Thread必然存在于一个ThreadGroup中，Thread是不能独立于ThreadGroup存在。
1.3 ThreadGroup能管理着它下面的Thread，ThreadGroup是一个"标准的向下引用"的结构，这样设计的原因是防止：=="上级"线程被"下级"线程引用而无法有效地被GC回收==。

## 2.线程优先级
- Java中线程优先级可以指定，范围：1~10
- 未指定优先级的线程优先级为：默认级别：5
- 线程的执行由调度程序来决定
- 在线程调用之前，优先级就应被设定

2.1 &nbsp;&nbsp;JAVA线程是存在优先级概念的，高优先级的线程将会比低优先级的线程有更高的几率得到执行。我们使用方法：setPriority()来设定线程的级别。

```
  Thread a = new Thread();
        System.out.println("我是默认线程优先级："+a.getPriority());
        Thread b = new Thread();
        b.setPriority(10);
        System.out.println("我是设置过的线程优先级："+b.getPriority());
    
```
得到以下结果:
```
我是默认线程优先级：5
我是设置过的线程优先级：10
```
2.2 &nbsp;&nbsp;Java中的优先级是否完全可靠？<br>
&nbsp;&nbsp;&nbsp;&nbsp;既然有1-10的顺序来设定了线程的优先级，这时候可能有些老铁会问，那么我是不是可以在业务实现的时候，采用这种方法来执行一些常用功能的先后顺序。对于这个问题，我们的答案是:No!<br>
Java中的优先级来说不是特别的可靠，系统会自带一个优先级。换句话说：Java程序中对线程所设置的优先级只是给系统一个提示一个建议，系统不一定会采纳。而真正的调用，是由系统的cpu调度执行该线程，所以我们在使用线程优先级时候，一定要慎重。这也叫做是线程的随机性。<br>
&nbsp;&nbsp;&nbsp;&nbsp;我们通过代码的结果来验证一下：

```
public class T1 extends Thread{

    @Override
    public void run(){
        super.run();
        System.out.println("ThreadRun");
}
    public static void main(String[] args) {
        IntStream.range(0,5).forEach(i->{
                    T1 myThread = new T1();
                    Thread thread = new Thread(myThread);
                    thread.start();
                    System.out.println("good");
        });
    }
}
```
执行结果是:
```
good
ThreadRun
good
good
good
good
ThreadRun
ThreadRun
ThreadRun
ThreadRun
```
&nbsp;&nbsp;&nbsp;&nbsp;本该是"ThreadRun"和"good"交替输出，但是由于线程优先级的随机性，从而使得到了不规律的结果。CPU是以一种随机的方式来选择调用run()方法或者继续执行main()方法。

Java自身调度线程是怎么做的呢？<br>
&nbsp;&nbsp;&nbsp;&nbsp;Java提供一个线程调度器来监视和控制Runnable状态的线程。线程的调度策略采用==抢占式==,优先级高的线程比优先级低的线程优先执行。在优先级相同的情况下，按照“先到先得”的原则。每个Java程序都有一个默认的主线程，就是通过JVM启动的第一个线程。
还有一种线程称为守护线程（Daemon），这是一种用于监视其他线程工作的服务线程，优先级为最低。

在之前，我们有谈到Thread必然存在于一个ThreadGroup中，那么当线程和线程组的优先级有冲突的时候将会怎样呢？
```
 public static void main(String[] args) {

    ThreadGroup threadGroup = new ThreadGroup("t1");
    threadGroup.setMaxPriority(6);
    Thread thread = new Thread(threadGroup,"thread");
    thread.setPriority(9);
    System.out.println("我是线程组的优先级"+threadGroup.getMaxPriority());
    System.out.println("我是线程的优先级"+thread.getPriority());
    }
```
运行得到:
```
我是线程组的优先级6
我是线程的优先级6
```
所以在线程组中的线程，如果指定的线程优先级大于线程所在group的优先级，那么指定的优先级将会失效，取而代之的是group的最大优先级。



