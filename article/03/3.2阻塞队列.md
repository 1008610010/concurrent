## 阻塞队列的由来 

我们假设一种场景，生产者一直生产资源，消费者一直消费资源，资源存储在一个缓冲池中，生产者将生产的资源存进缓冲池中，消费者从缓冲池中拿到资源进行消费，这就是大名鼎鼎的**生产者-消费者模式**。

我们自己coding实现这个模式的时候，因为需要让**多个线程操作共享变量**（即资源），所以很容易引发**线程安全问题**，造成**重复消费**和**死锁**，尤其是生产者和消费者存在多个的情况。

这么容易出错的事情，jdk当然帮我们做啦，这就是阻塞队列(BlockingQueue)，**你只管往里面存、取就行，而不用担心多线程环境下存、取共享变量的线程安全问题。**

> BlockingQueue是Java util.concurrent包下重要的数据结构，区别于普通的队列，BlockingQueue提供了**线程安全的队列访问方式**，并发包下很多高级同步类的实现都是基于BlockingQueue实现的。

BlockingQueue一般用于生产者-消费者模式，生产者是往队列里添加元素的线程，消费者是从队列里拿元素的线程。**BlockingQueue就是存放元素的容器**。

## BlockingQueue的操作方法

阻塞队列提供了四组不同的方法用于插入、移除、检查元素：

| 方法\处理方式 | 抛出异常  | 返回特殊值 |  一直阻塞  |      超时退出      |
| :-----------: | :-------: | :--------: | :--------: | :----------------: |
|   插入方法    |  add(e)   |  offer(e)  | **put(e)** | offer(e,time,unit) |
|   移除方法    | remove()  |   poll()   | **take()** |  poll(time,unit)   |
|   检查方法    | element() |   peek()   |     -      |         -          |

- 抛出异常：如果试图的操作无法立即执行，抛异常。当阻塞队列满时候，再往队列里插入元素，会抛出IllegalStateException(“Queue full”)异常。当队列为空时，从队列里获取元素时会抛出NoSuchElementException异常 。
- 返回特殊值：如果试图的操作无法立即执行，返回一个特殊值，通常是true / false。
- 一直阻塞：如果试图的操作无法立即执行，则一直阻塞或者响应中断。
- 超时退出：如果试图的操作无法立即执行，该方法调用将会发生阻塞，直到能够执行，但等待时间不会超过给定值。返回一个特定值以告知该操作是否成功，通常是 true / false。 

**注意之处**

* 不能往阻塞队列中插入null,会抛出空指针异常。
* 可以访问阻塞队列中的任意元素，调用remove(o)可以将队列之中的特定对象移除，但并不高效，尽量避免使用。

## BlockingQueue的实现类

1. **ArrayBlockingQueue**

   由**数组**结构组成的**有界**阻塞队列。内部结构是数组，故具有数组的特性。

   ```java
   public ArrayBlockingQueue(int capacity, boolean fair){
       //..省略代码
   }
   ```

   可以初始化队列大小， 且一旦初始化不能改变。构造方法中的fair表示控制对象的内部锁是否采用公平锁，默认是**非公平锁**。

2. **LinkedBlockingQueue**

   由**链表**结构组成的**有界**阻塞队列。内部结构是链表，具有链表的特性。默认大小是```Integer.MAX_VALUE```，此队列按照**先进先出**的原则对元素进行排序。 

3. **DelayQueue**

    该队列对元素进行持有，直到一个特定的延迟到期。注入其中的元素必须实现 java.util.concurrent.Delayed 接口。 

4. **PriorityBlockingQueue** 

   **无界**的并发队列，元素必须实现 java.lang.Comparable 接口。因此该队列中元素的排序就取决于你自己的 Comparable 实现。 

5. **SynchronousQueue**

   **特殊的队列，它的内部同时只能够容纳单个元素**。如果该队列已有一元素的话，试图向队列中插入一个新元素的线程将会阻塞，直到另一个线程将该元素从队列中抽走。同样，如果该队列为空，试图向队列中抽取一个元素的线程将会阻塞，直到另一个线程向队列中插入了一条新的元素。 

   这个队列不像是一个队列，更像是一个转移点。

## 阻塞队列的原理

## 示例和使用场景

## 生产者消费者模型

## 参考文章

1. [Java中的阻塞队列](http://ifeve.com/java-blocking-queue/)
2. [Java并发编程：阻塞队列](https://www.cnblogs.com/dolphin0520/p/3932906.html)

